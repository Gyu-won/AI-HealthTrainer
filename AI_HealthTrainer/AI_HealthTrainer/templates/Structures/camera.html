{% load static %}
<!DOCTYPE html>
<html lang = "ko">
<head>
  <meta charset="utf-8" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>Camera</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat%3A800"/>
  <link rel="stylesheet" href="{% static 'styles/camera.css' %}">
</head>
<body>
<div class="camera-main">
  <p class="header-title">CAMERA</p>
  <div class="camera-header">
    <div class="header-bg"><img id="camera-viewer" src="" alt="Webcam Video"></div>
  </div>
  <div class="camera-info">
    <div class="info-bg1"></div>
    <div class="info-bg2"></div>
    <p class="time-text" id="mins">10</p>
    <p class="time-text" id="min-unit">min</p>
    <p class="time-text" id="seconds">00</p>
    <p class="time-text" id="second-unit">sec</p>
    <p class="set-text" id="set-num">1/3</p>
    <p class="set-text" id="set-unit">sets</p>
  </div>
</div>
<p id="feedback"></p>
<script src="{% static 'javascripts/indexforCamera.js' %}"></script>
<script>
  var video = document.getElementById('camera-viewer');
  var prev_feedback = "";
  video.src = "/video_feed";

  function fetchData() {
      fetch("/get_feedback/")
          .then(response => response.json())
          .then(data => {
              const userInfoElement = document.getElementById("feedback");
              var feedback_text = data.textData
              userInfoElement.innerHTML = `
                  <strong>Feedback:</strong> ${feedback_text}<br>
              `;
              
              if (feedback_text != prev_feedback){
                  prev_feedback = feedback_text;
                  return textToSpeech(feedback_text);
              }
          })
          .catch(error => {
              console.error("Error fetching data:", error);
          });
  }

  let synth = speechSynthesis;
  
  function textToSpeech(text) {
      console.log("call textToSpeech");
      let utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en'
      synth.speak(utterance);
      
  }

  setInterval(fetchData, 300);
</script>
</body>
</html>